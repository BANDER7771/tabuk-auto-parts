[1mdiff --git a/routes/orders.js b/routes/orders.js[m
[1mindex 9c2f9a2..c4a56e5 100644[m
[1m--- a/routes/orders.js[m
[1m+++ b/routes/orders.js[m
[36m@@ -193,6 +193,28 @@[m [mrouter.post('/', (req, res, next) => {[m
             }[m
         }[m
 [m
[32m+[m[32m        // ===== WA: notify on order created =====[m
[32m+[m[32m        try {[m
[32m+[m[32m            const sendWA = req.app?.locals?.sendWhatsApp;[m
[32m+[m[32m            if (typeof sendWA === 'function') {[m
[32m+[m[32m                const orderId = (order?._id || '').toString();[m
[32m+[m[32m                const orderNo = order?.orderNumber || orderId.slice(-6);[m
[32m+[m
[32m+[m[32m                const phone =[m
[32m+[m[32m                    String(order?.customerPhone || order?.customer?.phone || order?.phone || '').replace(/\D/g, '');[m
[32m+[m
[32m+[m[32m                if (phone) {[m
[32m+[m[32m                    const link = process.env.APP_PUBLIC_URL ? `${process.env.APP_PUBLIC_URL}/orders/${orderId}` : '';[m
[32m+[m[32m                    const msg = `ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨Ùƒ Ø±Ù‚Ù… ${orderNo}. Ø³Ù†ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ø®Ù„Ø§Ù„ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ø¹Ù…Ù„ 8Øµâ€“8Ù… (Ø¹Ø¯Ø§ Ø§Ù„Ø¬Ù…Ø¹Ø©).${link ? '\nØ±Ø§Ø¨Ø· Ø§Ù„Ø·Ù„Ø¨: ' + link : ''}`;[m
[32m+[m[32m                    await sendWA(phone, msg);[m
[32m+[m[32m                } else {[m
[32m+[m[32m                    console.warn('WA skip (create): no customer phone on order');[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m[32m        } catch (e) {[m
[32m+[m[32m            console.error('WA error (create):', e?.message);[m
[32m+[m[32m        }[m
[32m+[m
         // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± ÙˆØ§ØªØ³Ø§Ø¨ ÙÙ‚Ø·[m
         const deliveryText = deliveryOption === 'express' ? 'Ù…Ø³ØªØ¹Ø¬Ù„ (1-2 Ø³Ø§Ø¹Ø©) - 50 Ø±ÙŠØ§Ù„' : [m
                            deliveryOption === 'standard' ? 'Ø³Ø±ÙŠØ¹ (3-5 Ø³Ø§Ø¹Ø§Øª) - 25 Ø±ÙŠØ§Ù„' : [m
[36m@@ -367,17 +389,24 @@[m [mrouter.put('/admin/:id/status', async (req, res) => {[m
         await order.save();[m
         console.log('âœ… Order status updated:', order.orderNumber, 'to', status);[m
 [m
[31m-        // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ù„Ø¥Ø¯Ø§Ø±Ø© Ø¹Ù† ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©[m
[32m+[m[32m        // ===== WA: notify on status updated =====[m
         try {[m
[31m-            await sendOrderNotification({[m
[31m-                orderNumber: order.orderNumber,[m
[31m-                customerName: order.customerName,[m
[31m-                customerPhone: order.customerPhone,[m
[31m-                partDetails: status,[m
[31m-                description: `ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ Ø¥Ù„Ù‰: ${status}`[m
[31m-            });[m
[31m-        } catch (whatsappError) {[m
[31m-            console.error('âŒ WhatsApp notification error:', whatsappError);[m
[32m+[m[32m            const sendWA = req.app?.locals?.sendWhatsApp;[m
[32m+[m[32m            if (typeof sendWA === 'function') {[m
[32m+[m[32m                const orderId = (order?._id || '').toString();[m
[32m+[m[32m                const orderNo = order?.orderNumber || orderId.slice(-6);[m
[32m+[m
[32m+[m[32m                const phone =[m
[32m+[m[32m                    String(order?.customerPhone || order?.customer?.phone || order?.phone || '').replace(/\D/g, '');[m
[32m+[m
[32m+[m[32m                if (phone) {[m
[32m+[m[32m                    const link = process.env.APP_PUBLIC_URL ? `${process.env.APP_PUBLIC_URL}/orders/${orderId}` : '';[m
[32m+[m[32m                    const msg = `ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø·Ù„Ø¨Ùƒ Ø±Ù‚Ù… ${orderNo} Ø¥Ù„Ù‰: ${order?.status || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©'}.${link ? '\nØ±Ø§Ø¨Ø· Ø§Ù„Ø·Ù„Ø¨: ' + link : ''}`;[m
[32m+[m[32m                    await sendWA(phone, msg);[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m[32m        } catch (e) {[m
[32m+[m[32m            console.error('WA error (status):', e?.message);[m
         }[m
 [m
         res.json({[m
[36m@@ -473,6 +502,26 @@[m [mrouter.put('/:orderNumber/status', async (req, res) => {[m
         await order.save();[m
         console.log('âœ… Order status updated:', order.orderNumber, 'to', status);[m
 [m
[32m+[m[32m        // ===== WA: notify on status updated =====[m
[32m+[m[32m        try {[m
[32m+[m[32m            const sendWA = req.app?.locals?.sendWhatsApp;[m
[32m+[m[32m            if (typeof sendWA === 'function') {[m
[32m+[m[32m                const orderId = (order?._id || '').toString();[m
[32m+[m[32m                const orderNo = order?.orderNumber || orderId.slice(-6);[m
[32m+[m
[32m+[m[32m                const phone =[m
[32m+[m[32m                    String(order?.customerPhone || order?.customer?.phone || order?.phone || '').replace(/\D/g, '');[m
[32m+[m
[32m+[m[32m                if (phone) {[m
[32m+[m[32m                    const link = process.env.APP_PUBLIC_URL ? `${process.env.APP_PUBLIC_URL}/orders/${orderId}` : '';[m
[32m+[m[32m                    const msg = `ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø·Ù„Ø¨Ùƒ Ø±Ù‚Ù… ${orderNo} Ø¥Ù„Ù‰: ${order?.status || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©'}.${link ? '\nØ±Ø§Ø¨Ø· Ø§Ù„Ø·Ù„Ø¨: ' + link : ''}`;[m
[32m+[m[32m                    await sendWA(phone, msg);[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m[32m        } catch (e) {[m
[32m+[m[32m            console.error('WA error (status):', e?.message);[m
[32m+[m[32m        }[m
[32m+[m
         res.json({[m
             message: 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨',[m
             order[m
[1mdiff --git a/server.js b/server.js[m
[1mindex 33c64a3..d7e8c49 100644[m
[1m--- a/server.js[m
[1m+++ b/server.js[m
[36m@@ -10,6 +10,46 @@[m [mdotenv.config();[m
 [m
 const app = express();[m
 [m
[32m+[m[32m// ===== WhatsApp (Twilio) bootstrap - minimal =====[m
[32m+[m[32mconst twilio = require('twilio');[m
[32m+[m
[32m+[m[32mconst TW_SID   = process.env.TWILIO_ACCOUNT_SID;[m
[32m+[m[32mconst TW_TOKEN = process.env.TWILIO_AUTH_TOKEN;[m
[32m+[m[32mconst TW_FROM  = process.env.TWILIO_FROM_WHATSAPP; // ÙŠØ¬Ø¨ Ø£Ù† ØªØ¨Ø¯Ø£ Ø¨Ù€ whatsapp:+[m
[32m+[m
[32m+[m[32mconst waEnabled = Boolean([m
[32m+[m[32m  TW_SID && TW_TOKEN && /^whatsapp:\+\d{8,15}$/.test(String(TW_FROM || ''))[m
[32m+[m[32m);[m
[32m+[m
[32m+[m[32mconst waClient = waEnabled ? twilio(TW_SID, TW_TOKEN) : null;[m
[32m+[m
[32m+[m[32masync function sendWhatsApp(toE164, body) {[m
[32m+[m[32m  if (!waClient) return { ok: false, reason: 'wa_disabled' };[m
[32m+[m[32m  const msisdn = String(toE164 || '').replace(/\D/g, '');[m
[32m+[m[32m  if (!msisdn) return { ok: false, reason: 'invalid_msisdn' };[m
[32m+[m
[32m+[m[32m  const to = `whatsapp:+${msisdn}`;[m
[32m+[m[32m  try {[m
[32m+[m[32m    const msg = await waClient.messages.create({ from: TW_FROM, to, body });[m
[32m+[m[32m    return { ok: true, sid: msg.sid };[m
[32m+[m[32m  } catch (e) {[m
[32m+[m[32m    console.error('WA send failed:', e?.message);[m
[32m+[m[32m    return { ok: false, reason: 'twilio_error', error: e?.message };[m
[32m+[m[32m  }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m// Ø¥ØªØ§Ø­Ø© Ø§Ù„Ø¯Ø§Ù„Ø© Ù„Ù„Ø±Ø§ÙˆØªØ±Ø§Øª[m
[32m+[m[32mapp.locals.sendWhatsApp = sendWhatsApp;[m
[32m+[m
[32m+[m[32m// Ù†Ù‚Ø·Ø© ÙØ­Øµ Ù„Ù„ØªØ·ÙˆÙŠØ± ÙÙ‚Ø·[m
[32m+[m[32mif (process.env.NODE_ENV !== 'production') {[m
[32m+[m[32m  app.get('/dev/wa-ping', async (req, res) => {[m
[32m+[m[32m    const to = req.query.to || '';[m
[32m+[m[32m    const r = await sendWhatsApp(to, 'Test: WhatsApp is working âœ…');[m
[32m+[m[32m    res.json({ enabled: waEnabled, ...r });[m
[32m+[m[32m  });[m
[32m+[m[32m}[m
[32m+[m
 // ============================================[m
 // 1. Health Check - Ø£ÙˆÙ„ Ø´ÙŠØ¡ (Ù‚Ø¨Ù„ Ø£ÙŠ middleware)[m
 // ============================================[m
[36m@@ -20,7 +60,8 @@[m [mapp.get('/health', (req, res) => {[m
         uptime: process.uptime(),[m
         environment: process.env.NODE_ENV || 'production',[m
         database: mongoose.connection.readyState === 1 ? 'connected' : 'disconnected',[m
[31m-        port: process.env.PORT || 3000[m
[32m+[m[32m        port: process.env.PORT || 3000,[m
[32m+[m[32m        whatsapp: /^whatsapp:\+/.test(String(process.env.TWILIO_FROM_WHATSAPP || '')) ? 'enabled' : 'disabled'[m
     });[m
 });[m
 [m
